# Nginx configuration file for running on AWS ECS

# Set the user that nginx will run as
user www-data;

# Set number of worker processes
# Should be based on number of CPU cores available
worker_processes auto;

# Access log directed to stderr
error_log /dev/stderr;

# The pid file location for nginx
pid /run/nginx.pid;

# Set maximum connections per worker
events {
    worker_connections 1024;
}

# HTTP section configures how nginx handles HTTP traffic
http {
    # Include mime types
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Set max body size to prevent large uploads
    client_max_body_size 10M;
     
    # Set log format
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    # Access log directed to stdout
    access_log  /dev/stdout main;

    # Use the tcp_nopush directive together with the sendfile on;directive.
    # This enables NGINX to send HTTP response headers in one packet
    # after the chunk of data has been obtained by sendfile().
    sendfile on;
    tcp_nopush on;

    # Sets TCP_NODELAY flag, used on keepalive connections
    # and set keepalive timeout
    tcp_nodelay on;
    keepalive_timeout  65;

    # Enable gzip compression
    gzip  on;

    # Include virtual host configs
    include /etc/nginx/conf.d/*.conf;
}